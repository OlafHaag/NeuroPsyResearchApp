# uncontrolledmanifold.kv
#:kivy 1.11.1
#:include src/widgets/buttons.kv
#:include src/widgets/popups.kv
#:include src/widgets/screenconsents.kv
#:include src/widgets/screeninstructions.kv
#:include src/widgets/screencircletask.kv

<UCMManager>:
    settings: app.settings
    # The first screen added, will be initially displayed.
    ScreenHome:
    ScreenConsentCircleTask:
        name: 'Consent CT'
    ScreenInstructCircleTask:
        name: 'Instructions CT'
    ScreenCircleTask:
    ScreenOutro:

<ScreenHome>:
    name: 'Home'
    on_leave: home_scroll.scroll_y = 1

    BoxLayout:
        orientation: 'vertical'

        ScrollView:
            id: home_scroll
            do_scroll_x: False
            do_scroll_y: True

            Label:
                text: root.home_msg
                markup: True
                text_size: root.width, None
                font_size: sp(24)
                size: self.texture_size
                size_hint_y: None
                padding: 10, 10
                halign: 'center'
                valign: 'middle'

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.2
            RoundedButton:
                text: _("Settings")
                on_release:
                    root.manager.transition.direction = 'up'
                    root.manager.transition.duration = 0.5
                    app.open_settings()
            RoundedButton:
                text: _("Proceed")
                on_release:
                    root.manager.transition.direction = 'up'
                    root.manager.transition.duration = 0.5
                    root.manager.current = root.manager.task_consents[app.settings.task]

<ScreenOutro>:
    name: 'Outro'
    settings: app.settings

    BoxLayout:
        orientation: 'vertical'

        Label:
            text: root.outro_msg
            markup: True
            text_size: root.width, None
            size: self.texture_size
            halign: 'center'
            valign: 'middle'
        Label:
            text: "[b]" + _("Personal Identifier:") + "[/b]\n" + app.settings.user
            markup: True
            text_size: root.width, None
            size: self.texture_size
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.4
            RoundedButton:
                text: _("Send via E-Mail")
                disabled: not app.settings.is_email_enabled
                on_release:
                    app.send_email()
            RoundedButton:
                id: upload_btn
                text: _("Upload")
                disabled: not app.upload_btn_enabled
                on_release: root.on_upload()
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.4
            RoundedButton:
                text: _("Home")
                on_release:
                    app.settings.reset_current()
                    root.manager.go_home()
            RoundedButton:
                text: _("Quit")
                on_release: root.manager.quit()
